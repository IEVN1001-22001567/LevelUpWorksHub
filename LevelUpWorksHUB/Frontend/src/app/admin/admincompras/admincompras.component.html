<!-- ENCABEZADO AMARILLO -->
<div class="bg-yellow-500 p-6 rounded-t-lg">
  <div class="flex items-center space-x-3">
    <i class="pi pi-shopping-bag text-black text-3xl"></i>
    <h1 class="text-2xl font-bold text-black">Gestión de Compras</h1>
  </div>
  <p class="text-black mt-1">Panel administrativo para gestionar todas las compras y pedidos</p>
</div>

<!-- CONTENIDO GENERAL -->
<div class="bg-[#1a1a1a] p-6 rounded-b-lg">

  <!-- MENSAJES DE ERROR/CARGA -->
  <div *ngIf="cargando" class="mb-4 p-4 bg-blue-900 border border-blue-600 text-blue-200 rounded">
    ⏳ Cargando compras...
  </div>

  <div *ngIf="errorMsg" class="mb-4 p-4 bg-red-900 border border-red-600 text-red-200 rounded">
    ❌ {{ errorMsg }}
  </div>

  <!-- TARJETAS DE ESTADÍSTICAS -->
  <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Total</h3>
      <p class="text-2xl font-bold text-yellow-500">{{ totalCompras }}</p>
    </div>

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Pendientes</h3>
      <p class="text-2xl font-bold text-blue-400">{{ pendientes }}</p>
    </div>

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Procesando</h3>
      <p class="text-2xl font-bold text-blue-300">{{ procesando }}</p>
    </div>

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Completadas</h3>
      <p class="text-2xl font-bold text-green-500">{{ completadas }}</p>
    </div>

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Canceladas</h3>
      <p class="text-2xl font-bold text-red-500">{{ canceladas }}</p>
    </div>

    <div class="bg-[#121212] border border-yellow-600 p-4 rounded-lg">
      <h3 class="text-gray-300">Ingresos</h3>
      <p class="text-2xl font-bold text-yellow-500">${{ ingresosTotales.toFixed(2) }}</p>
    </div>
  </div>

  <!-- TABLA GRANDE DE COMPRAS -->
  <div class="bg-[#121212] border border-yellow-600 p-6 rounded-xl">

    <h2 class="text-yellow-500 text-xl font-semibold">Compras Registradas</h2>
    <p class="text-gray-400 mb-4">Gestiona todas las compras del sistema</p>

    <!-- INPUT BUSCAR -->
    <div class="mb-4">
      <input
        type="text"
        placeholder="Buscar por ID, usuario, email o producto..."
        class="w-full p-2 rounded bg-[#1f1f1f] border border-yellow-700 text-white"
        [(ngModel)]="searchTerm"
        (input)="filtrarCompras()"
      />
    </div>

    <!-- MENSAJE SI NO HAY COMPRAS -->
    <div *ngIf="!cargando && comprasFiltradas.length === 0" class="text-center py-6 text-gray-400">
      <p>No hay compras registradas</p>
    </div>

    <!-- TABLA -->
    <div class="overflow-x-auto" *ngIf="comprasFiltradas.length > 0">
      <table class="w-full text-left text-gray-300">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="py-2">ID Orden</th>
            <th class="py-2">Cliente</th>
            <th class="py-2">Producto</th>
            <th class="py-2">Total</th>
            <th class="py-2">Estado</th>
            <th class="py-2">Fecha</th>
            <th class="py-2">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let compra of comprasFiltradas" class="border-b border-gray-800 hover:bg-[#222]">
            <td class="py-3 font-semibold">{{ compra.comprasID }}</td>
            <td>
              <span class="font-semibold">{{ compra.username || 'Usuario ' + compra.usuarioid }}</span><br />
              <span class="text-gray-500 text-sm">{{ compra.email || 'N/A' }}</span>
            </td>
            <td>
              <span class="text-sm">{{ compra.nombreproducto }}</span>
            </td>
            <td class="text-yellow-500 font-bold">${{ compra.precio.toFixed(2) }}</td>
            <td>
              <span 
                [ngClass]="'px-3 py-1 rounded-full text-sm ' + getEstadoBadgeClass(compra.estado)"
              >
                {{ getEstadoTexto(compra.estado) }}
              </span>
            </td>
            <td class="text-sm">{{ compra.fechacompra | date:'dd/MM/yyyy HH:mm' }}</td>
            <td class="space-x-3 flex gap-2">
              <button
                (click)="verDetalles(compra)"
                title="Ver detalles"
                class="text-blue-400 hover:text-blue-300 cursor-pointer"
              >
                <i class="pi pi-eye"></i>
              </button>
              <button
                (click)="cambiarEstado(compra, compra.estado === 'pagado' ? 'cancelado' : 'pagado')"
                title="Cambiar estado"
                class="text-yellow-400 hover:text-yellow-300 cursor-pointer"
              >
                <i class="pi pi-pencil"></i>
              </button>
              <button
                (click)="eliminarCompra(compra)"
                title="Eliminar compra"
                class="text-red-500 hover:text-red-400 cursor-pointer"
              >
                <i class="pi pi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>

</div>
